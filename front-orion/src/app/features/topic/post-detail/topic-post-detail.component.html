<app-header></app-header>

<main class="px-6 py-10">
  <div class="mx-auto flex w-full max-w-3xl flex-col gap-6">
    <div class="flex items-center justify-between">
      <section class="flex flex-col gap-2 text-left">
        <h1 class="text-2xl font-semibold text-gray-900">
          Détail de l’article
        </h1>
        @if (post()?.topicName) {
        <h2 class="text-2xl text-[#7763C5] font-bold">
          {{ post()!.topicName }}
        </h2>
        }
      </section>
      <a
        class="inline-flex h-10 items-center justify-center rounded-lg border border-gray-300 px-4 text-sm font-medium text-gray-700 hover:bg-gray-100"
        [routerLink]="['/posts/topics', topicId()]"
        aria-label="Retour à la liste des articles"
      >
        Retour vers {{ post()?.topicName || "le thème" }}
      </a>
    </div>

    @if (isLoading()) {
    <div
      class="rounded-lg border border-gray-200 bg-white px-4 py-6 text-sm text-gray-700"
    >
      Chargement de l'article...
    </div>
    } @else if (hasError()) {
    <div
      class="rounded-lg border border-red-200 bg-red-50 px-4 py-6 text-sm text-red-700"
    >
      {{ errorMessage() ?? "Une erreur inattendue est survenue." }}
    </div>
    } @else if (post()) {
    <article class="space-y-4 rounded-xl border border-gray-200 p-6 shadow-sm">
      <header class="space-y-1">
        <h1 class="text-xl font-semibold text-gray-900">{{ post()!.title }}</h1>
        <div class="flex flex-wrap items-center gap-3 text-xs text-gray-500">
          <span>{{ post()!.createdAt | date : "dd/MM/yyyy" }}</span>
          <span class="h-1 w-1 rounded-full bg-gray-300"></span>
          <span>{{ post()!.authorUsername }}</span>
          <span class="h-1 w-1 rounded-full bg-gray-300"></span>
          <span>{{ post()!.topicName }}</span>
        </div>
      </header>

      <p class="text-sm text-gray-700 whitespace-pre-line">
        {{ post()!.content }}
      </p>

      <hr />

      <section class="space-y-4">
        <h2 class="text-base font-semibold">Commentaires</h2>
        @if (post()!.comments.length === 0) {
        <p class="text-sm text-gray-500">Aucun commentaire pour ce post.</p>
        } @else {
        <div class="space-y-3">
          @for (c of post()!.comments; track c.id) {
          <div class="flex items-start gap-3">
            <span class="text-xs text-gray-600 w-24 shrink-0">{{
              c.authorUsername
            }}</span>
            <div class="rounded-lg bg-gray-100 px-4 py-2 text-sm text-gray-800">
              {{ c.content }}
            </div>
          </div>
          }
        </div>
        } @if (actionError()) {
        <div
          class="rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-xs text-red-700"
        >
          {{ actionError() }}
        </div>
        }

        <form
          class="flex items-end gap-3"
          (ngSubmit)="submitComment()"
          [formGroup]="commentForm"
        >
          <div class="flex-1">
            <textarea
              formControlName="content"
              rows="3"
              class="w-full rounded-lg border border-gray-300 px-4 py-3 text-sm text-gray-900 transition focus:border-[#7763C5] focus:outline-none focus:ring-2 focus:ring-[#7763C5]/40"
              placeholder="Écrivez ici votre commentaire"
              [disabled]="isSubmitting()"
            ></textarea>
          </div>
          <button
            type="submit"
            class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-[#7763C5] text-white hover:bg-[#5c4ca3] disabled:opacity-60 disabled:cursor-not-allowed"
            [disabled]="isSubmitting() || commentForm.invalid"
            aria-label="Envoyer le commentaire"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="h-5 w-5"
            >
              <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
            </svg>
          </button>
        </form>
      </section>
    </article>
    }
  </div>
</main>
